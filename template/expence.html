<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>Expense</title>

    <!-- Fontfaces CSS-->
    <link href="css/font-face.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/theme.css" rel="stylesheet" media="all">
<script type="text/javascript" charset="utf-8" async defer>
    function loaddata() {
            fetchexp();
        }    
</script>
</head>

<body class="animsition" onLoad="loaddata();">
    <div class="page-wrapper">
      <!-- HEADER MOBILE-->
        <header class="header-mobile d-block d-lg-none">
            <div class="header-mobile__bar">
                <div class="container-fluid">
                    <div class="header-mobile-inner">
                        <a class="logo" href="index.html">
                            <img src="images/icon/logo.png" alt="CoolAdmin" />
                        </a>
                        <button class="hamburger hamburger--slider" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <nav class="navbar-mobile">
                <div class="container-fluid">
                    <ul class="navbar-mobile__list list-unstyled">
                    <li class="has-sub">
                        <a class="js-arrow" href="#">
                            <i class="fas fa-tachometer-alt"></i>Home</a>
                        
                        </li>
                        <li class="active">
                            <a href="document.html">
                                <i class="fas fa-chart-bar"></i>Document</a>
                        </li>
                        <li>
                            <a href="branch.html">
                                <i class="far fa-check-square"></i>Branch</a>
                        </li>
                        <li>
                            <a href="employee.html">
                                <i class="fas fa-calendar-alt"></i>Employee</a>
                        </li>
                        <li>
                            <a href="task.html">
                                <i class="fas fa-map-marker-alt"></i>Task</a>
                        </li>
                         <li>
                            <a href="expence.html">
                                <i class="fas fa-map-marker-alt"></i>Expense</a>
                        </li>
                         <li>
                            <a href="map.html">
                                <i class="fas fa-map-marker-alt"></i>UI Element</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- END HEADER MOBILE-->

        <!-- MENU SIDEBAR-->
        <aside class="menu-sidebar d-none d-lg-block">
            <div class="logo">
                <a href="#">
                    <img src="images/icon/logo.png" alt="Cool Admin" />
                </a>
            </div>
            <div class="menu-sidebar__content js-scrollbar1">
                <nav class="navbar-sidebar">
                    <ul class="list-unstyled navbar__list">
                        <li class=" has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-tachometer-alt"></i>Home</a>
                            
                        </li>
                       <li class="active">
                            <a href="document.html">
                                <i class="fas fa-chart-bar"></i>Document</a>
                        </li>
                        <li>
                            <a href="branch.html">
                                <i class="far fa-check-square"></i>Branch</a>
                        </li>
                        <li>
                            <a href="employee.html">
                                <i class="fas fa-calendar-alt"></i>Employees</a>
                        </li>
                        <li>
                            <a href="task.html">
                                <i class="fas fa-map-marker-alt"></i>Task</a>
                        </li>
                        <li>
                            <a href="expence.html">
                            <i class="fas fa-map-marker-alt"></i>Expense</a>
                        </li>
                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                              <i class="fas fa-desktop"></i>UI Element</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>
        <!-- END MENU SIDEBAR-->

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- HEADER DESKTOP-->
            <header class="header-desktop">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="header-wrap">
                            <form class="form-header" action="" method="POST">
                                <input class="au-input au-input--xl" type="text" name="search" placeholder="Search for datas &amp; reports..." />
                                <button class="au-btn--submit" type="submit">
                                    <i class="zmdi zmdi-search"></i>
                                </button>
                            </form>
                            <div class="header-button">
                               <div class="account-wrap">
                                    <div class="account-item clearfix js-item-menu">
                                        <div class="image">
                                            <img src="images/icon/avatar-01.jpg" alt="John Doe" />
                                        </div>
                                        <div class="content">
                                            <a class="js-acc-btn" href="#">john doe</a>
                                        </div>
                                        <div class="account-dropdown js-dropdown">
                                            <div class="info clearfix">
                                                <div class="image">
                                                    <a href="#">
                                                        <img src="images/icon/avatar-01.jpg" alt="John Doe" />
                                                    </a>
                                                </div>
                                                <div class="content">
                                                    <h5 class="name">
                                                        <a href="#">john doe</a>
                                                    </h5>
                                                    <span class="email">johndoe@example.com</span>
                                                </div>
                                            </div>
                                            <div class="account-dropdown__body">
                                                <div class="account-dropdown__item">
                                                    <a href="#">
                                                        <i class="zmdi zmdi-account"></i>Account</a>
                                                </div>
                                                <div class="account-dropdown__item">
                                                    <a href="#">
                                                        <i class="zmdi zmdi-settings"></i>Setting</a>
                                                </div>
                                                <div class="account-dropdown__item">
                                                    <a href="#">
                                                        <i class="zmdi zmdi-money-box"></i>Billing</a>
                                                </div>
                                            </div>
                                            <div class="account-dropdown__footer">
                                                <a href="#">
                                                    <i class="zmdi zmdi-power"></i>Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- HEADER DESKTOP-->

            <!-- MAIN CONTENT-->
            <div class="main-content">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="row">

                                 <div class="col-md-9 alertmsg" style="display:none;">
                                    <div class="sufee-alert alert with-close alert-info alert-dismissible fade show">
                                        <span class="badge badge-pill badge-secondary">Success</span>
                                        You have successfully performed.
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                 </div>

                             <div class="col-lg-8">
                              
                             </div>
                              <div class="col-lg-4" style="text-align: right;">
                                <div class="card-body">
                                <button class="au-btn au-btn-icon au-btn--green au-btn--small" data-toggle="modal" data-target="#largeModal">
                                    <i class="zmdi zmdi-plus"></i>Add Expense</button>
                                </div>
                             </div>
                            
                        </div>
                        <div class="row">
                            
                         <div class="col-lg-10">
                                <div class="table-responsive table--no-card m-b-30">
                                    <table class="table table-borderless table-striped table-earning">
                                        <thead>
                                            <tr>
                                                <th>Expense Name</th>
                                                <th class="text-center">Action</th>  
                                            </tr>
                                        </thead>
                                        <tbody class="exp">
                                           
                                        </tbody>
                                    </table>
                                </div>
                            
                            </div>


                        </div>

                </div>
            </div>
        </div>
       


         <div class="modal fade" id="largeModal" tabindex="-1" role="dialog" aria-labelledby="largeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="expense_category">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="largeModalLabel">Large Modal</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                           <div class="card">
                                    <div class="card-header"></div>
                                    <div class="card-body">
                                        <div class="card-title">
                                            <h3 class="text-center title-2">Add Expense</h3>
                                        </div>
                                        <hr>
                                        <form action="" method="post" novalidate="novalidate" name="expreg">
                                            
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="form-group">
                                                        
                                                        <input id="expname" name="cc-exp" placeholder="Expense Name" type="tel" class="form-control cc-exp" value="" data-val="true" data-val-required="Please enter the card expiration"
                                                            data-val-cc-exp="Please enter a valid month and year" 
                                                            autocomplete="cc-exp">
                                                        <span class="help-block" data-valmsg-for="cc-exp" data-valmsg-replace="true"></span>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    
                                                <button id="adexp" type="button" class="btn btn-lg btn-info btn-block">
                                                    <i >Add</i>&nbsp;
                                                    <span id="payment-button-amount"></span>
                                                    <span id="regv" style="display:none;">Registering</span>
                                                </button>
                                            
                                                </div>
                                            </div> 
                                            
                                           
                                            
                                        </form>
                                    </div>
                                </div>
                        </div>
                       
                    </div>
                </div>
            </div>


             <!-- modal delete popup -->
            <div class="modal fade" id="staticModal" tabindex="-1" role="dialog" aria-labelledby="staticModalLabel" aria-hidden="true"
             data-backdrop="static">
                <div class="modal-dialog modal-sm" role="expense_category">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staticModalLabel">Delete Expense</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>
                                Are you sure you want delete this entry ..???
                            </p>
                        </div>
                        <input type="hidden" name="" class="dlt" >
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onClick="delete_expense();">Confirm</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end modal deletepopup -->


            <!-- MODDEL FOR EDIT BRANCH -->

         <div class="modal fade" id="largeModalEdit" tabindex="-1" role="dialog" aria-labelledby="largeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="expense_category">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="largeModalLabel"></h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                           <div class="card">
                                    <div class="card-body">
                                        <div class="card-title">
                                            <h3 class="text-center title-2">Edit Expense</h3>
                                        </div>
                                        <hr>
                                        <form id="formEdit" name="editingform">                                           
                                            <div class="row">
                                                <div class="col-12">
                                                    <div class="form-group">
                                                        <label for="cc-exp" class="control-label mb-1">Expense Name *</label>
                                                        <input id="expnm" name="expnm" type="text" class="form-control cc-exp" value="" data-val="true" placeholder="Please enter expense name"
                                                            autocomplete="cc-exp">
                                                        <span class="help-block" data-valmsg-for="cc-exp" data-valmsg-replace="true"></span>
                                                    </div>
                                                </div>
                                            
                                                
                                           <input type="hidden" name="did" id="model_did" value="">
                                           </div>
                                            <div class="row">
                                                <div class="col-12">
                                                    <div>
                                                        <button id="reg" type="submit" class="btn btn-lg btn-info btn-block">
                                                            <i class="fa fa-lock fa-lg"></i>&nbsp;
                                                            <span id="payment-button-amount">Update</span>
                                                            <span id="regv" style="display:none;">Updating</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                        </div>
                       
                    </div>
                </div>
            </div>


    <!-- Jquery JS-->
    <script src="vendor/jquery-3.2.1.min.js"></script>
    <!-- Bootstrap JS-->
    <script src="vendor/bootstrap-4.1/popper.min.js"></script>
    <script src="vendor/bootstrap-4.1/bootstrap.min.js"></script>
    <!-- Vendor JS       -->
    <script src="vendor/slick/slick.min.js"></script>
    <script src="vendor/wow/wow.min.js"></script>
    <script src="vendor/animsition/animsition.min.js"></script>
    <script src="vendor/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
    <script src="vendor/counter-up/jquery.waypoints.min.js"></script>
    <script src="vendor/counter-up/jquery.counterup.min.js"></script>
    <script src="vendor/circle-progress/circle-progress.min.js"></script>
    <script src="vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="vendor/chartjs/Chart.bundle.min.js"></script>
    <script src="vendor/select2/select2.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
    <!-- Main JS-->
    <script src="js/main.js"></script>
   <script type="text/javascript" charset="utf-8" async defer>
   function fetchexp()
   {
      // alert("hhhhh");
      // console.log("kjgjhgjh")
        var htmcnt='';
        $.getJSON('http://127.0.0.1:5000/view_expense', function (data)
        {
            // console.log(data);
            for (var i = 0; i < data.length; i++)
             {
                 htmcnt=htmcnt+'<tr><td>'+data[i].name+'</td><td style="text-align: center;"><button type="" class="btn btn-primary" onclick="edit_expense('+data[i].id+');">Edit</button>&nbsp;&nbsp;&nbsp;&nbsp;<button class="btn btn-danger dltBtn" data-id='+data[i].id+'>Delete</button></td></tr>';
             }
           $('.exp').html(htmcnt)
        });      
    }
    $(function() {
      // Initialize form validation on the registration form.
      $("form[name='editingform']").validate({
        // Specify validation rules
        rules: {
          // on the right side
          expnm: "required",
        },
        // Specify validation error messages
        messages: {
          expnm: "Please enter expense name",
        },
        unhighlight: function (element) {
             $("select").removeClass("error");
             $("input").removeClass("error");
         },
        // Make sure the form is submitted to the destination defined
        // in the "action" attribute of the form when valid
        submitHandler: function(form) 
        {
            var did = $("#model_did").val();
            var expnm = $("#expnm").val();
        
            $.getJSON('http://127.0.0.1:5000/update_expense', {
                            expid: did,
                            name: expnm
                            
                        }, function (data) {
                            $('.alertmsg').css('display','block')  
                                      // alert box hide after 2 seconds
                            $('.alertmsg').delay(2000).fadeOut();
                            fetchexp();
                            $('#largeModalEdit').modal('hide')  
                        });
                    }
              });
        });
function edit_expense(id) {
    $('#model_did').val(id)
    $.ajax({
                  url: "http://127.0.0.1:5000/edit_expense?expid="+id,
                  type: 'GET',
                  dataType: 'json',
                })
                .done(function(data) 
                {
                   console.log(data)
                   $('#expnm').val(data[0].name)
               })
                .fail(function() {
                  console.log("error");
                });
                
                $('#largeModalEdit').modal('show')
    }

 $(document).on('click','.dltBtn',function(){
    var id=$(this).data('id');
    alert(id);
    $('.dlt').val(id);
   $('#staticModal').modal('show');

 }); 
function delete_expense(id) {
    // Function for Branch list delete entry
       var id= $('.dlt').val();
            $.ajax({
                  url: "http://127.0.0.1:5000/delete_expense?dex="+id,
                  type: 'GET',
                })
                .done(function(data) {
                  $('.alertmsg').css('display','block')  
                          // alert box hide after 2 seconds
                  $('.alertmsg').delay(2000).fadeOut();
                  $('#staticModal').modal('hide');
                  fetchexp();
                })
                .fail(function(data) {
                  console.log("error");
                });    
    }
// Clear model items when hide the model
    $('#largeModalEdit').on('hidden.bs.modal', function () {
        $(this).find("input,textarea,select").val('').end();
        $(this).find("input,textarea,select").removeClass('error')
        $("label[class='error']").css('display','none')
    });

    $('#largeModal').on('hidden.bs.modal', function () {
        $(this).find("input,textarea,select").val('').end();
        $(this).find("input,textarea,select").removeClass('error')
        $("label[class='error']").css('display','none')
    });

</script>
<script>
    $(document).on('click', '#adexp', function () 
    {
        var dcn = $("#expname").val();
        alert(dcn);
        $.getJSON('http://127.0.0.1:5000/expense_reg',
        {
            expense_category: dcn
            
        },function (data) 
        {
                $('.alertmsg').css('display','block')  
                // alert box hide after 2 seconds
                $('.alertmsg').delay(2000).fadeOut();
                fetchexp();
                $('#largeModal').modal('hide')  
        });
    });
</script>
</body>
</html>
<!-- end document-->
